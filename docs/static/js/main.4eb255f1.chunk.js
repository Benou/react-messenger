(this["webpackJsonpreact-messenger"]=this["webpackJsonpreact-messenger"]||[]).push([[0],{21:function(e,t,n){e.exports={backdrop:"Modal_backdrop__1mfF6",modal:"Modal_modal__4DXUe",header:"Modal_header__b50LG",content:"Modal_content__3zUnK",actions:"Modal_actions__1JvhX"}},25:function(e,t,n){e.exports={"message-list-item":"MessageListItem_message-list-item__2__n2","my-message":"MessageListItem_my-message__2hG70","message-list-item-avatar":"MessageListItem_message-list-item-avatar__3kbJ2","message-list-item-text":"MessageListItem_message-list-item-text__2n3Wd"}},30:function(e,t,n){e.exports={"input-group":"Input_input-group__2Hdg7",error:"Input_error__3PKU4","input-group-hint":"Input_input-group-hint__3KtHr"}},31:function(e,t,n){e.exports={"message-form":"MessageForm_message-form__24d-O","message-form-input":"MessageForm_message-form-input__cgS_g","message-form-button":"MessageForm_message-form-button__17RGZ"}},34:function(e,t,n){e.exports={card:"Card_card__1m44e","card-content":"Card_card-content__3UkRz"}},36:function(e,t,n){e.exports={"login-form":"LoginForm_login-form__2XSjU","login-form-actions":"LoginForm_login-form-actions__15yJs"}},37:function(e,t,n){e.exports={"register-form":"RegisterForm_register-form__1c6UZ","register-form-actions":"RegisterForm_register-form-actions__2IzsN"}},38:function(e,t,n){e.exports={button:"Button_button__6-R6B"}},43:function(e,t,n){e.exports={login:"Login_login__3Yjas"}},44:function(e,t,n){e.exports={register:"Register_register__p8NiQ"}},45:function(e,t,n){e.exports={avatar:"MonsterAvatar_avatar__12tYE"}},46:function(e,t,n){e.exports={"monster-list":"MonsterList_monster-list__j3AIT"}},47:function(e,t,n){e.exports={logout:"Logout_logout__2Ul18"}},48:function(e,t,n){e.exports={"message-list":"MessageList_message-list__2fK9y"}},49:function(e,t,n){e.exports={messenger:"Messenger_messenger__2bFAF"}},66:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var s=n(23),r=n.n(s),a=n(20),c=n.n(a),i=n(27),o=n(6),u=n(1),l=n.n(u),m=n(29),j=n(28),b=(n(69),n(56),j.a.initializeApp({apiKey:"AIzaSyBPlOX2ypEClUQio0xV3Fqc8PfIfsObchI",authDomain:"react-messenger-b2e6f.firebaseapp.com",projectId:"react-messenger-b2e6f",storageBucket:"react-messenger-b2e6f.appspot.com",messagingSenderId:"152213607737",appId:"1:152213607737:web:61bfdb9f3ae32a317184e8"})),d=b.auth(),f=b.firestore(),g=f.collection("messages"),O=g.orderBy("createdAt").limit(25),p=f.collection("monsters"),h=p.where("visible","==",!0),x=n(24),v=function(e,t){var n=e?p.where("userId","==",e.uid):null,s=Object(x.a)(n,{idField:"id"}),r=Object(o.a)(s,1)[0],a=Object(u.useState)(null),l=Object(o.a)(a,2),m=l[0],j=l[1],b=Object(u.useCallback)((function(){p.add({userId:e.uid,monsterId:t,visible:!1})}),[e,t]),d=Object(u.useCallback)(function(){var e=Object(i.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,p.doc("".concat(m.id)).update({visible:t});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[m]);return Object(u.useEffect)((function(){r&&(r.length?j(r[0]):b())}),[r,b]),[m,d]},_=n(5),w=n(34),y=n.n(w),C=n(2),I=function(e){var t=e.className,n=e.children,s=[y.a.card,t||""].filter((function(e){return e.length})).join(" ");return Object(C.jsx)("div",{className:s,children:Object(C.jsx)("div",{className:y.a["card-content"],children:n})})},N=n(19),k=n(38),M=n.n(k),S=["className","children","type"],L=function(e){var t=e.className,n=e.children,s=e.type,r=Object(N.a)(e,S),a=[M.a.button,t||""].filter((function(e){return e.length})).join(" ");return Object(C.jsx)("button",Object(_.a)(Object(_.a)({type:s||"button",className:a},r),{},{children:n}))},E=n(21),V=n.n(E),F=function(e){var t=e.onConfirm;return Object(C.jsx)("div",{className:V.a.backdrop,onClick:t})},B=function(e){var t=e.title,n=e.message,s=e.onConfirm;return Object(C.jsxs)(I,{className:V.a.modal,children:[Object(C.jsx)("header",{className:V.a.header,children:Object(C.jsx)("h2",{children:t})}),Object(C.jsx)("div",{className:V.a.content,children:Object(C.jsx)("p",{children:n})}),Object(C.jsx)("footer",{className:V.a.actions,children:Object(C.jsx)(L,{onClick:s,children:"Okay"})})]})},A=function(e){var t=e.title,n=e.message,s=e.onConfirm;return Object(C.jsxs)(u.Fragment,{children:[r.a.createPortal(Object(C.jsx)(F,{onConfirm:s}),document.getElementById("backdrop-root")),r.a.createPortal(Object(C.jsx)(B,{title:t,message:n,onConfirm:s}),document.getElementById("overlay-root"))]})},P=l.a.createContext({isVisible:!1,show:function(e,t){}}),D={title:"",message:"",isVisible:!1},z=function(e,t){switch(t.type){case"SHOW_MODAL":return Object(_.a)(Object(_.a)({},e),{},{isVisible:!0,title:t.title,message:t.message});default:return Object(_.a)({},D)}},q=function(e){var t=e.children,n=Object(u.useReducer)(z,Object(_.a)({},D)),s=Object(o.a)(n,2),r=s[0],a=s[1],c=Object(u.useCallback)((function(e,t){a({type:"SHOW_MODAL",title:e,message:t})}),[]);return Object(C.jsxs)(P.Provider,{value:{isVisible:r.isVisible,show:c},children:[r.isVisible&&Object(C.jsx)(A,Object(_.a)(Object(_.a)({},r),{},{onConfirm:function(){a({type:"HIDE_MODAL"})}})),t]})},R=P,T=l.a.createContext({user:null,creationTime:0,signIn:function(e,t){},signOut:function(){},register:function(e,t){}}),U="react-messenger-credentials",J=function(e){var t=e.children,n=Object(u.useContext)(R).show,s=Object(m.a)(d),r=Object(o.a)(s,1)[0],a=Object(m.c)(d),l=Object(o.a)(a,4),j=l[0],b=l[3],f=Object(m.b)(d),g=Object(o.a)(f,4),O=g[0],p=g[3],h=r?new Date(r.metadata.creationTime).getTime():0,x=v(r,h),_=Object(o.a)(x,2),w=_[0],y=_[1],I=Object(u.useCallback)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];j(e,t),n?localStorage.setItem(U,JSON.stringify({email:e,password:t})):localStorage.removeItem(U)}),[j]),N=Object(u.useCallback)(Object(i.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.signOut();case 2:y(!1);case 3:case"end":return e.stop()}}),e)}))),[y]),k=Object(u.useCallback)((function(e,t){O(e,t)}),[O]);return Object(u.useEffect)((function(){var e=JSON.parse(localStorage.getItem(U));e&&I(e.email,e.password,!0)}),[I]),Object(u.useEffect)((function(){(b||p)&&n("Oups une erreur est survenue",(b||p).toString())}),[b,p,n]),Object(u.useEffect)((function(){r&&w&&y(!0)}),[r,w,y]),Object(C.jsx)(T.Provider,{value:{user:r,creationTime:h,signIn:I,signOut:N,register:k},children:t})},H=T,K=n(16),X=n(7),G=["children"],W=function(e){var t=e.children,n=Object(N.a)(e,G),s=Object(u.useContext)(H).user;return Object(C.jsx)(X.b,Object(_.a)(Object(_.a)({},n),{},{render:function(){return s?t:Object(C.jsx)(X.a,{to:{pathname:"/login"}})}}))},Q=n(15),Y=function(e){var t=Object.entries(e).map((function(e){return Object(o.a)(e,2)[1][0]})),n=Object(u.useState)({}),s=Object(o.a)(n,2),r=s[0],a=s[1];return Object(u.useEffect)((function(){var t=setTimeout((function(){a(Object.entries(e).reduce((function(e,t){var n=Object(o.a)(t,2),s=n[0],r=Object(o.a)(n[1],2),a=r[0],c=r[1];return Object(_.a)(Object(_.a)({},e),{},Object(Q.a)({},s,c.every((function(e){return e(a)}))))}),{}))}),250);return function(){return clearTimeout(t)}}),t),r},Z=n(41),$=n(42),ee=function(e){return void 0===e||null===e||0===e.replace(/\s+/g," ").trim().length},te=function(){function e(){Object(Z.a)(this,e)}return Object($.a)(e,null,[{key:"required",value:function(){return function(e){return!ee(e)}}},{key:"minlength",value:function(e){return function(t){return!!ee(t)||!((ee(t)?0:t.length)<e)}}},{key:"maxlength",value:function(e){return function(t){return!!ee(t)||!((ee(t)?0:t.length)>e)}}},{key:"pattern",value:function(e){return function(t){if(ee(t))return!0;var n="string"===typeof e?new RegExp(e):null;return n&&n.test(t)}}},{key:"email",value:function(){return e.pattern(".+@.+")}},{key:"password",value:function(t){return e.pattern(t)}}]),e}(),ne=n(30),se=n.n(ne),re=["className","id","type","label","error"],ae=function(e){var t=e.className,n=e.id,s=e.type,r=e.label,a=e.error,c=Object(N.a)(e,re),i=[se.a["input-group"],t||"",a?se.a.error:""].filter((function(e){return e.length})).join(" ");return Object(C.jsxs)("div",{className:i,children:[r&&Object(C.jsx)("label",{htmlFor:n,children:r}),Object(C.jsx)("input",Object(_.a)({id:n,type:s||"text"},c)),!!a&&Object(C.jsx)("p",{className:se.a["input-group-hint"],children:a})]})},ce=n(36),ie=n.n(ce),oe=function(e){var t=e.onLogin,n=Object(u.useState)(""),s=Object(o.a)(n,2),r=s[0],a=s[1],c=Object(u.useState)(""),i=Object(o.a)(c,2),l=i[0],m=i[1],j=Object(u.useState)({}),b=Object(o.a)(j,2),d=b[0],f=b[1],g=Y({email:[r,[te.required(),te.email(),te.maxlength(64)]],password:[l,[te.required(),te.minlength(8),te.maxlength(16)]]}),O=function(e){f((function(t){return Object(_.a)(Object(_.a)({},t),{},Object(Q.a)({},e.target.id,!0))}))};return Object(C.jsx)(I,{children:Object(C.jsxs)("form",{className:ie.a["login-form"],onSubmit:function(e){e.preventDefault(),g.email&&g.password&&t({email:r,password:l})},noValidate:!0,autoComplete:"off",children:[Object(C.jsx)(ae,{id:"email",type:"email",label:"E-mail",value:r,error:d.email&&!g.email&&"Veuillez saisir votre e-mail",maxLength:"64",onChange:function(e){a(e.target.value)},onBlur:O}),Object(C.jsx)(ae,{id:"password",type:"password",label:"Mot de passe",value:l,error:d.password&&!g.password&&"Veuillez saisir votre mot de passe",minLength:"8",maxLength:"16",onChange:function(e){m(e.target.value)},onBlur:O}),Object(C.jsxs)("div",{className:ie.a["login-form-actions"],children:[Object(C.jsx)(K.b,{to:"/register",children:"Cr\xe9er un compte"}),Object(C.jsx)(L,{type:"submit",disabled:!g.email||!g.password,children:"Se connecter"})]})]})})},ue=n(43),le=n.n(ue),me=function(){var e=Object(X.g)(),t=Object(u.useContext)(H),n=t.user,s=t.signIn;Object(u.useEffect)((function(){n&&e.push("/messenger")}),[n,e]);return Object(C.jsx)("div",{className:le.a.login,children:Object(C.jsx)(oe,{onLogin:function(e){var t=e.email,n=e.password;s(t,n)}})})},je=n(44),be=n.n(je),de=n(37),fe=n.n(de),ge=function(e){var t=e.onRegister,n=e.onCancel,s=Object(u.useState)(""),r=Object(o.a)(s,2),a=r[0],c=r[1],i=Object(u.useState)(""),l=Object(o.a)(i,2),m=l[0],j=l[1],b=Object(u.useState)(""),d=Object(o.a)(b,2),f=d[0],g=d[1],O=Object(u.useState)({}),p=Object(o.a)(O,2),h=p[0],x=p[1],v=Y({email:[a,[te.required(),te.email(),te.maxlength(64)]],password:[m,[te.required(),te.minlength(8),te.maxlength(16)]],confirmPassword:[f,[te.required(),te.password(m)]]}),w=function(e){x((function(t){return Object(_.a)(Object(_.a)({},t),{},Object(Q.a)({},e.target.id,!0))}))};return Object(C.jsx)(I,{children:Object(C.jsxs)("form",{className:fe.a["register-form"],onSubmit:function(e){e.preventDefault(),v.email&&v.password&&v.confirmPassword&&t({email:a,password:m})},noValidate:!0,autoComplete:"off",children:[Object(C.jsx)(ae,{id:"email",type:"email",label:"E-mail",value:a,error:h.email&&!v.email&&"Veuillez saisir votre e-mail au bon format",maxLength:"64",onChange:function(e){c(e.target.value)},onBlur:w}),Object(C.jsx)(ae,{id:"password",type:"password",label:"Mot de passe",value:m,error:h.password&&!v.password&&"Veuillez saisir un mot de passe entre 8 et 16 charact\xe8res",minLength:"8",maxLength:"16",onChange:function(e){j(e.target.value)},onBlur:w}),Object(C.jsx)(ae,{id:"confirmPassword",type:"password",label:"Confirmation du mot de passe",value:f,error:h.confirmPassword&&!v.confirmPassword&&"Veuillez saisir le m\xeame mot de passe",minLength:"8",maxLength:"16",onChange:function(e){g(e.target.value)},onBlur:w}),Object(C.jsxs)("div",{className:fe.a["register-form-actions"],children:[Object(C.jsx)(L,{onClick:n,children:"Annuler"}),Object(C.jsx)(L,{type:"submit",disabled:!v.email||!v.password||!v.confirmPassword,children:"Cr\xe9er mon compte"})]})]})})},Oe=function(){var e=Object(X.g)(),t=Object(u.useContext)(H),n=t.user,s=t.register;Object(u.useEffect)((function(){n&&e.push("/messenger")}),[n,e]);return Object(C.jsx)("div",{className:be.a.register,children:Object(C.jsx)(ge,{onRegister:function(e){var t=e.email,n=e.password;s(t,n)},onCancel:function(){e.push("/login")}})})},pe=n(45),he=n.n(pe),xe=function(e){var t=e.className,n=e.monsterId,s=[he.a.avatar,t||""].filter((function(e){return e.length})).join(" ");return Object(C.jsx)("img",{className:s,src:"https://www.gravatar.com/avatar/".concat(n,"?d=monsterid&f=y"),alt:"avatar"})},ve=n(46),_e=n.n(ve),we=function(e){var t=e.monsters;return Object(C.jsx)("ul",{className:_e.a["monster-list"],children:(t||[]).map((function(e){return Object(C.jsx)("li",{children:Object(C.jsx)(xe,{monsterId:e.monsterId})},e.id)}))})},ye=n(47),Ce=n.n(ye),Ie=function(e){var t=e.monsters,n=Object(u.useContext)(H).signOut;return Object(C.jsxs)("div",{className:Ce.a.logout,children:[Object(C.jsx)(we,{monsters:t}),Object(C.jsx)(L,{onClick:n,children:"D\xe9connexion"})]})},Ne=n(31),ke=n.n(Ne),Me=function(e){var t=e.onAddMessage,n=Object(u.useState)(""),s=Object(o.a)(n,2),r=s[0],a=s[1],c=Object(u.useState)({}),i=Object(o.a)(c,2),l=i[0],m=i[1],j=Y({message:[r,[te.required(),te.maxlength(128)]]});return Object(C.jsx)(I,{children:Object(C.jsx)("form",{onSubmit:function(e){e.preventDefault(),j.message&&(t(r),a(""),m({}))},noValidate:!0,autoComplete:"off",children:Object(C.jsxs)("div",{className:ke.a["message-form"],children:[Object(C.jsx)(ae,{id:"message",className:ke.a["message-form-input"],placeholder:"Dites quelque chose...",value:r,error:l.message&&!j.message&&"Veuillez saisir un message",maxLength:"128",onChange:function(e){a(e.target.value)},onBlur:function(e){m((function(t){return Object(_.a)(Object(_.a)({},t),{},Object(Q.a)({},e.target.id,!0))}))}}),Object(C.jsx)(L,{type:"submit",className:ke.a["message-form-button"],disabled:!j.message,children:"Envoyer"})]})})})},Se=n(25),Le=n.n(Se),Ee=function(e){var t=e.id,n=e.text,s=e.isMyMessage,r=e.monsterId,a=[Le.a["message-list-item"],s?Le.a["my-message"]:""].filter((function(e){return e.length})).join(" ");return Object(C.jsxs)("li",{className:a,id:"message-".concat(t),children:[Object(C.jsx)(xe,{className:Le.a["message-list-item-avatar"],monsterId:r}),Object(C.jsx)("div",{className:Le.a["message-list-item-text"],children:n})]})},Ve=n(48),Fe=n.n(Ve),Be=function(e){var t=(e.messages||[]).map((function(e){return Object(u.createElement)(Ee,Object(_.a)(Object(_.a)({},e),{},{key:e.id}))}));return Object(C.jsx)(I,{className:Fe.a["message-list"],children:Object(C.jsx)("ul",{children:t})})},Ae=n(49),Pe=n.n(Ae),De=function(){var e=Object(u.useContext)(H),t=e.user,n=e.creationTime,s=Object(x.a)(O,{idField:"id"}),r=Object(o.a)(s,1)[0],a=Object(x.a)(h,{idField:"id"}),c=Object(o.a)(a,1)[0],i=(r||[]).map((function(e){return Object.assign(e,{isMyMessage:e.userId===t.uid})}));return Object(u.useEffect)((function(){if(i.length){var e=i[i.length-1],t=document.getElementById("message-".concat(e.id));t&&t.scrollIntoView({behavior:"smooth"})}}),[i]),Object(C.jsxs)("div",{className:Pe.a.messenger,children:[Object(C.jsx)(Ie,{monsters:c}),Object(C.jsx)(Be,{messages:i}),Object(C.jsx)(Me,{onAddMessage:function(e){g.add({text:e,createdAt:j.a.firestore.FieldValue.serverTimestamp(),userId:t.uid,monsterId:n})}})]})},ze=(n(66),function(){return Object(C.jsx)(K.a,{basename:"/react-messenger",children:Object(C.jsxs)(X.d,{children:[Object(C.jsx)(X.b,{path:"/login",children:Object(C.jsx)(me,{})}),Object(C.jsx)(X.b,{path:"/register",children:Object(C.jsx)(Oe,{})}),Object(C.jsx)(W,{path:"/messenger",children:Object(C.jsx)(De,{})}),Object(C.jsx)(X.b,{path:"/**",children:Object(C.jsx)(X.a,{to:"/login"})})]})})});n(67);r.a.render(Object(C.jsx)(q,{children:Object(C.jsx)(J,{children:Object(C.jsx)(ze,{})})}),document.getElementById("root"))}},[[68,1,2]]]);
//# sourceMappingURL=main.4eb255f1.chunk.js.map